/*! Pizza-Hut-Pilot-App v0.0.1a 2013-04-04 13:ii */
var App=function(){};_.templateSettings={interpolate:/\{(.+?)\}/g,evaluate:/\{\[(.+?)\]\}/g},App.controllers={},$(function(){"use strict";console.info("App is Go!!!")}),App.util={},function(){"use strict";var t=App.util,e={},i=Array.prototype.slice;_.extend(t,{emptyFn:function(){},ns:function(t,i){if(!_.isString(t))throw Error("Invalid namespace, must be a string");if(e.hasOwnProperty(t))return e[t];var n,s,r,a=t.split("."),o=a.length-1,p=a[o],l=window;if(o>0)for(r=0;o>r;r+=1)n=a[r],s=l[n],_.isObject(s)||(l[n]={}),l=l[n];return l[p]=l[p]||i,l=l[p],e[t]=l,l},def:function(e,i){var n,s,r=App.abstract?App.abstract.BaseClass:function(){},a=i.extend?t.ns(i.extend):r,o=!1;_.extend(i,{$super:a.prototype}),o=!0,n=new a,o=!1,_.extend(n,i),s=function(){!o&&this.init&&this.init.apply(this,arguments)},s.prototype=n,_.extend(s.prototype,{constructor:s,$className:e}),t.ns(e,s)},init:function(){var e,n=arguments,s=n[0],r=i.call(arguments,1);if(_.isFunction(s))e=s;else{if(!_.isString(s)||1>s.length)throw Error("Invalid class name '"+(""+s)+"' specified, must be a non-empty string");e=t.ns(s)}if(!e)throw Error("Cannot create an instance of unrecognized class name: "+(""+s));if(!_.isFunction(e))throw Error(""+s+"' is a singleton and cannot be instantiated");return new(t.instantiator(r))(e,r)},instantiator:function(t){var e,i=[];for(e=0;t.length>e;e+=1)i.push("a["+e+"]");return Function("c","a","return new c("+i.join(",")+")")}}),_.extend(App,{apply:t.apply,def:t.def,init:t.init,ns:t.ns})}(),App.def("App.util.Controller",{init:function(){"use strict";var t;this.$name=t=this.$className.replace("App.controller.",""),App.ns("App.controllers."+t,this)}}),App.def("App.abstract.BaseClass",{init:function(t){"use strict";var e=this;_.extend(e,Backbone.Events),e.trigger("init",e,arguments),e.initConfig(t)},callParent:function(t,e,i){"use strict";this.$super[t].apply(i||this,e)},initConfig:function(t){"use strict";_.extend(this,t)}}),App.def("App.abstract.Page",{tpl:void 0,data:void 0,html:void 0,applyTo:void 0,el:void 0,$el:void 0,id:void 0,autoShow:!1,init:function(){"use strict";var t=this;t.$super.init.apply(t,arguments),_.isString(t.tpl)?t.initTpl():_.isString(t.html)&&t.setHtml()},initTpl:function(){"use strict";var t=this;t.$tpl=t.tpl,t.tpl=_.template(t.tpl),(_.isObject(t.data)||_.isArray(t.data))&&t.setData()},setData:function(t){"use strict";var e=this;t&&(e.data=t),e.reset(),(e.autoShow===!0||e.el)&&e.paint(),e.trigger("update",e,e.data,e.tpl)},setHtml:function(t){"use strict";var e=this,i=t||e.html,n=e.$el,s=e.id||_.uniqueId("page_");n||(e.$el=n=$(document.createElement("div")).attr("id",s)),n.html(i),e.autoShow===!0&&setTimeout(function(){e.paint()},1)},reset:function(){"use strict";var t=this;t.remove(),delete t.el},paint:function(t){"use strict";var e=this;return e.el?!1:(t=t||e.applyTo,e.el=e.$el.clone(!0),e.trigger("beforepainted",e,e.$el,e.html),e.el.appendTo(t),e.trigger("painted",e,e.$el,e.html),void 0)},destroy:function(){"use strict";var t=this;t.off(),t.remove()},hide:function(){"use strict";this.el.hide()},remove:function(){"use strict";var t=this;t.el&&t.el.remove(),delete t.el},show:function(){"use strict";var t=this;return t.el?t.el.show():t.paint()}}),App.def("App.controller.Pizza",{extend:"App.util.Controller",canvas:void 0,builder:void 0,init:function(){"use strict";var t=this,e=t.builder=$(".pizza-builder");App.controllers.Pizza=t,e.delegate(".pb-topping","click",{me:t},t.onToppingClick),e.delegate(".topping-selectors li","click",t.onToppingGroupClick),$(document).on("click",{me:t},t.clearMenus)},onToppingClick:function(t){"use strict";var e=t.data.me,i=this.className.replace(/(\W*)pb\-topping(\W*)/,""),n="."+i,s=e.getCanvas(),r=s.children(n),a=$(t.currentTarget).offset();t.stopPropagation(),e.showMenu(a.left+35-97,a.top-40,i),r.length>0},onToppingGroupClick:function(t){"use strict";var e=$(this),i=e.hasClass("selected");t.stopPropagation(),i||(e.siblings(".selected").removeClass("selected"),e.addClass("selected"))},getCanvas:function(){"use strict";var t=this,e=t.canvas;return e?e:e=t.canvas=t.builder.children(".pb-canvas")},showMenu:function(t,e,i){"use strict";var n,s,r,a,o=this;n=['<div class="pb-toppings-menu">','<ul class="pb-topping-selector">','<li class="side-left">Left</li>','<li class="side-whole">Whole</li>','<li class="side-right">Right</li>',"</ul>","</div>"].join(""),$(".pb-toppings-menu").remove(),$("body").append(n),s=$(".pb-toppings-menu").css({top:e+"px",left:t+"px"}),r=o.findTopping(RegExp("(.*)"+i+"(.*)")),r.length>0&&(a=r[0].className.replace(i,"")),$(".pb-toppings-menu li.side"+a).addClass("selected"),$(".pb-toppings-menu li").on("click",{me:o,type:i},o.showTopping)},showTopping:function(t){"use strict";var e=t.data.me,i=t.data.type,n=$(this),s=e.getCanvas(),r=this.className.match(/side\-(\S*)/)[1],a=(s.children("."+i+"-"+r),RegExp(i+"-(S*)"));return e.findTopping(a).remove(),n.siblings().removeClass("selected"),n.hasClass("selected")?n.removeClass("selected"):(s.append('<div class="'+i+"-"+r+'"></div>'),n.addClass("selected"),void 0)},findTopping:function(t){"use strict";var e,i=this,n=i.getCanvas(),s=n.children();return e=s.filter(function(){return this.className.match(t)})},clearMenus:function(t){"use strict";$(t.target).parents(".pb-toppings-menu").length||$(".pb-toppings-menu").remove()}}),$(function(){"use strict";App.init("App.controller.Pizza")}),App.def("App.util.Registry",{init:function(){this.model=Backbone.Model.extend({}),this.collection=new Backbone.Collection([],{model:this.model})}}),App.def("App.view.builder.ToppingSideChooser",{extend:"App.abstract.Page",tpl:['<div class="pb-toppings-menu">','<ul class="pb-topping-selector">',"<li>Left</li>",'<li class="selected">Whole</li>',"<li>Right</li>","</ul>","</div>"].join(),data:{left:0,whole:1,right:0},xy:void 0,init:function(){"use strict";var t=this;t.$super.init.apply(t,arguments),t.xy&&t.on("beforepainted",t.showAt,t)},showAt:function(){"use strict";var t=this,e=_.isNumeric(arguments[0])&&_.isNumeric(arguments[1])?arguments:t.xy;t.el.css({top:e[1]+"px",left:e[0]+"px"})}});